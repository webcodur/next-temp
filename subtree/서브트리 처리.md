==================================================
Git Subtree를 활용한 Next.js 프롬프트 관리 시스템
==================================================

목차:
1. Git Subtree 기초 이해
2. 프롬프트 저장소 구축
3. 프로젝트에 Subtree 추가
4. 업데이트와 동기화
5. 실전 활용 시나리오
6. 문제 해결 가이드

==================================================
1. Git Subtree 기초 이해
==================================================

## Git Subtree란?

Git Subtree는 하나의 Git 저장소를 다른 저장소의 하위 디렉토리로 포함시키는 방법.
- Submodule과 달리 단일 저장소처럼 작동
- 별도의 .git 폴더 없음
- 팀원들이 subtree 존재를 모르고도 작업 가능
- 히스토리가 메인 프로젝트에 통합됨

## Subtree vs Submodule 비교

Subtree 장점:
- 클론 시 추가 명령 불필요
- 푸시/풀이 간단함
- 오프라인에서도 모든 코드 접근 가능
- 초보자 친화적

Subtree 단점:
- 메인 저장소 크기 증가
- 업스트림 변경사항 추적이 수동적
- 히스토리가 복잡해질 수 있음

## 언제 Subtree를 사용해야 하나?

적합한 경우:
✓ 여러 프로젝트에서 공통 문서/설정 공유
✓ 팀원들이 Git 초보자
✓ 의존성이 자주 변경되지 않음
✓ 오프라인 작업이 빈번함

부적합한 경우:
✗ 매우 큰 외부 라이브러리
✗ 빈번한 양방향 동기화 필요
✗ 독립적인 버전 관리 중요

==================================================
2. 프롬프트 저장소 구축
==================================================

## Step 1: 중앙 프롬프트 저장소 생성

```bash
# 새 저장소 생성
mkdir nextjs-prompts
cd nextjs-prompts
git init

# 기본 구조 생성
mkdir -p prompts/claude
mkdir -p prompts/cursor
mkdir -p templates
mkdir -p snippets
mkdir -p docs

# README 작성
echo "# Next.js 프롬프트 관리 시스템" > README.md
```

## Step 2: 프롬프트 구조 설계

```
nextjs-prompts/
├── README.md
├── prompts/
│   ├── claude/
│   │   ├── CLAUDE.md          # Claude AI용 기본 설정
│   │   ├── rules.md            # 코딩 규칙
│   │   └── context.md          # 프로젝트 컨텍스트
│   └── cursor/
│       ├── .cursorrules        # Cursor 에디터 규칙
│       └── settings.json       # VSCode 설정
├── templates/
│   ├── component.template.md   # 컴포넌트 생성 템플릿
│   ├── api.template.md         # API 통합 템플릿
│   └── refactor.template.md    # 리팩토링 템플릿
├── snippets/
│   ├── hooks/                  # 커스텀 훅 스니펫
│   ├── utils/                  # 유틸리티 함수
│   └── components/             # 컴포넌트 스니펫
└── docs/
    ├── usage.md                # 사용 가이드
    └── contributing.md         # 기여 가이드
```

## Step 3: 초기 커밋 및 원격 저장소 연결

```bash
# 초기 커밋
git add .
git commit -m "초기 프롬프트 시스템 구성"

# GitHub 저장소 연결 (저장소를 먼저 생성해야 함)
git remote add origin https://github.com/yourusername/nextjs-prompts.git
git branch -M main
git push -u origin main
```

==================================================
3. 프로젝트에 Subtree 추가
==================================================

## 새 프로젝트에 프롬프트 추가

```bash
# 프로젝트 루트에서 실행
cd /path/to/your/nextjs-project

# subtree 추가 (처음 한 번만)
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash

# --prefix=.prompts : 프로젝트 내 위치 지정
# --squash : 히스토리를 하나의 커밋으로 압축
```

## 기존 프로젝트에 추가

```bash
# 1. 현재 상태 커밋
git add .
git commit -m "프롬프트 시스템 추가 전 백업"

# 2. subtree 추가
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash

# 3. .gitignore 수정 (필요시)
echo "# 프롬프트는 추적함" >> .gitignore
echo "!.prompts/" >> .gitignore
```

## 프로젝트별 커스터마이징

```bash
# 프로젝트별 설정 파일 생성
cp .prompts/prompts/claude/CLAUDE.md ./CLAUDE.md

# 프로젝트 특화 내용 추가
cat >> ./CLAUDE.md << 'EOF'

# 프로젝트별 추가 규칙
## 이 프로젝트 고유 설정
- API 엔드포인트: https://api.myproject.com
- 주요 기능: 전자상거래 플랫폼
- 특별 요구사항: 결제 시스템 통합
EOF
```

==================================================
4. 업데이트와 동기화
==================================================

## Pull: 중앙 => 로컬 

```bash
# 프로젝트 디렉토리에서
cd /path/to/your/nextjs-project

# 최신 변경사항 가져오기
git subtree pull --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash

# 충돌 발생 시
git status
# 충돌 해결 후
git add .
git commit -m "프롬프트 업데이트 병합"
```

## Push: 로컬 => 중앙

```bash
# 프로젝트에서 수정한 프롬프트를 중앙으로 기여
git subtree push --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git feature/my-improvement

# GitHub에서 PR 생성하여 검토 후 병합
```

## 자동화 스크립트 작성

```bash
# scripts/sync-prompts.sh 생성
#!/bin/bash

# 프롬프트 업데이트 스크립트
PROMPT_REPO="https://github.com/yourusername/nextjs-prompts.git"
PROMPT_BRANCH="main"
PROMPT_PREFIX=".prompts"

echo "🔄 프롬프트 시스템 동기화 시작..."

# 현재 변경사항 확인
if [[ -n $(git status -s) ]]; then
    echo "⚠️  커밋되지 않은 변경사항이 있습니다. 먼저 커밋해주세요."
    exit 1
fi

# Pull 최신 변경사항
echo "📥 최신 프롬프트 가져오는 중..."
git subtree pull --prefix=$PROMPT_PREFIX $PROMPT_REPO $PROMPT_BRANCH --squash

echo "✅ 프롬프트 동기화 완료!"
```

## 별칭(Alias) 설정으로 간편하게 사용

```bash
# Git 별칭 추가 (.git/config 또는 global)
git config alias.prompt-pull 'subtree pull --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash'
git config alias.prompt-push 'subtree push --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git'

# 사용
git prompt-pull  # 업데이트 받기
git prompt-push feature/new-prompt  # 기여하기
```

==================================================
5. 실전 활용 시나리오
==================================================

## 시나리오 1: 새 Next.js 프로젝트 시작

```bash
# 1. Next.js 프로젝트 생성
npx create-next-app@latest my-app
cd my-app

# 2. Git 초기화 (이미 되어있으면 스킵)
git init
git add .
git commit -m "Initial commit"

# 3. 프롬프트 시스템 추가
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash

# 4. Claude/Cursor 설정 복사
cp .prompts/prompts/claude/CLAUDE.md ./
cp .prompts/prompts/cursor/.cursorrules ./

# 5. 프로젝트별 커스터마이징
echo "## 프로젝트: My App" >> CLAUDE.md
echo "## 주요 기능: ..." >> CLAUDE.md

# 6. 커밋
git add .
git commit -m "프롬프트 시스템 설정 완료"
```

## 시나리오 2: 팀 협업 환경

```bash
# 팀 리더가 초기 설정
git subtree add --prefix=.prompts https://github.com/team/nextjs-prompts.git main --squash
git push origin main

# 팀원은 단순 클론만
git clone https://github.com/team/project.git
# 프롬프트가 이미 포함되어 있음!

# 팀원이 프롬프트 개선
cd .prompts/templates/
echo "새로운 템플릿" > new.template.md
git add .
git commit -m "새 템플릿 추가"

# 중앙 프롬프트 저장소로 기여
git subtree push --prefix=.prompts https://github.com/team/nextjs-prompts.git feature/new-template
```

## 시나리오 3: 다중 프로젝트 관리

```bash
# 프로젝트 A
cd ~/projects/project-a
git subtree pull --prefix=.prompts https://github.com/org/prompts.git main --squash

# 프로젝트 B
cd ~/projects/project-b
git subtree pull --prefix=.prompts https://github.com/org/prompts.git main --squash

# 프로젝트 C
cd ~/projects/project-c
git subtree pull --prefix=.prompts https://github.com/org/prompts.git main --squash

# 모든 프로젝트 일괄 업데이트 스크립트
#!/bin/bash
PROJECTS=("project-a" "project-b" "project-c")
for project in "${PROJECTS[@]}"; do
    echo "Updating $project..."
    cd ~/projects/$project
    git subtree pull --prefix=.prompts https://github.com/org/prompts.git main --squash
done
```

## 시나리오 4: 버전별 프롬프트 관리

```bash
# 특정 버전/태그 사용
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git v1.0.0 --squash

# 브랜치별 관리
# Next.js 13용
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git nextjs13 --squash

# Next.js 14용
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git nextjs14 --squash
```

==================================================
6. 문제 해결 가이드
==================================================

## 일반적인 문제와 해결법

### 문제 1: "refusing to merge unrelated histories"
```bash
# 해결: --allow-unrelated-histories 옵션 사용
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash
```

### 문제 2: Subtree 위치 변경
```bash
# 기존 subtree 제거
git rm -r .prompts
git commit -m "기존 프롬프트 제거"

# 새 위치에 다시 추가
git subtree add --prefix=docs/prompts https://github.com/yourusername/nextjs-prompts.git main --squash
```

### 문제 3: 충돌 해결
```bash
# Pull 중 충돌 발생
git subtree pull --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash

# 충돌 파일 확인
git status

# 수동으로 충돌 해결
# VS Code 등 에디터에서 충돌 마커 해결

# 해결 완료 후
git add .
git commit -m "프롬프트 충돌 해결"
```

### 문제 4: 히스토리 정리
```bash
# squash 없이 추가한 경우 히스토리가 복잡해짐
# 해결: 처음부터 다시 추가
git filter-branch --index-filter 'git rm -r --cached --ignore-unmatch .prompts' HEAD
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash
```

### 문제 5: 실수로 프롬프트 수정한 경우
```bash
# 로컬 변경사항 되돌리기
git checkout HEAD -- .prompts/

# 또는 중앙 저장소에서 다시 받기
git rm -r .prompts
git commit -m "프롬프트 리셋"
git subtree add --prefix=.prompts https://github.com/yourusername/nextjs-prompts.git main --squash
```

==================================================
프로젝트 구조 예시
==================================================

최종적으로 각 Next.js 프로젝트는 다음과 같은 구조를 가집니다:

```
my-nextjs-app/
├── .prompts/                   # Subtree로 관리되는 공통 프롬프트
│   ├── prompts/
│   │   ├── claude/
│   │   └── cursor/
│   ├── templates/
│   └── snippets/
├── CLAUDE.md                   # 프로젝트별 커스터마이징 (복사본)
├── .cursorrules                # 프로젝트별 커스터마이징 (복사본)
├── src/                        # Next.js 소스 코드
├── public/
├── package.json
└── README.md

```

==================================================
권장 워크플로우
==================================================

## 초기 설정 (1회)
1. 중앙 프롬프트 저장소 생성
2. 기본 프롬프트와 템플릿 작성
3. GitHub에 푸시

## 새 프로젝트 시작 시
1. Next.js 프로젝트 생성
2. Subtree로 프롬프트 추가
3. 프로젝트별 커스터마이징
4. 개발 시작

## 주기적 업데이트 (주 1회)
1. 모든 프로젝트에서 `git prompt-pull` 실행
2. 변경사항 확인 및 테스트
3. 필요시 프로젝트별 조정

## 개선사항 기여
1. 로컬에서 프롬프트 개선
2. 테스트 및 검증
3. `git prompt-push` 로 PR 생성
4. 팀 리뷰 후 병합

==================================================
베스트 프랙티스
==================================================

## DO ✅
- 정기적으로 프롬프트 업데이트
- 프로젝트별 특성은 별도 파일로 관리
- 변경사항은 항상 PR을 통해 검토
- 버전 태그 활용하여 안정성 확보
- README에 프롬프트 사용법 문서화

## DON'T ❌
- .prompts 디렉토리 직접 수정 지양
- 무분별한 force push 금지
- 대용량 파일을 프롬프트에 포함시키지 않기
- 민감한 정보(API 키 등) 포함 금지
- 프로젝트 특화 내용을 중앙에 푸시하지 않기

==================================================
추가 리소스
==================================================

## 참고 문서
- Git Subtree 공식 문서: https://git-scm.com/book/en/v2/Git-Tools-Subtree-Merging
- GitHub Subtree 가이드: https://docs.github.com/en/get-started/using-git/about-git-subtree-merges
- Atlassian Git Subtree 튜토리얼: https://www.atlassian.com/git/tutorials/git-subtree

## 유용한 도구
- SourceTree: GUI로 subtree 관리
- GitKraken: 시각적 히스토리 확인
- VS Code Git Graph: 브랜치 구조 시각화

## 커뮤니티
- Next.js Discord
- GitHub Discussions
- Stack Overflow #git-subtree 태그