
# 로그인 기능 명세

이 시스템은 JWT 기반의 토큰 인증을 사용한다. 사용자가 로그인하면 액세스 토큰과 리프레시 토큰을 발급받고, 이 토큰들은 브라우저 쿠키에 안전하게 저장된다. 토큰에는 사용자의 권한 정보와 접근 가능한 주차장 정보가 포함되어 있어, 이를 기반으로 시스템 접근 범위가 결정된다.

## 인증 방식

기본적으로 계정과 비밀번호를 입력받아 서버에서 검증한다. 인증에 성공하면 JWT 형태의 토큰 2개(액세스, 리프레시)를 발급받는다.

**구성 요소:**
- 계정/비밀번호 기반 로그인
- JWT 토큰 (액세스 + 리프레시) 활용
- 쿠키 기반 토큰 저장

## 토큰 구성

토큰은 사용자 인증 정보와 권한 범위를 담고 있다. 액세스 토큰은 실제 API 호출에 사용되고, 리프레시 토큰은 액세스 토큰 만료시 새로 발급받기 위해 사용된다.

**저장 위치:**
- 액세스 토큰: `accessToken` 쿠키
- 리프레시 토큰: `refreshToken` 쿠키

**토큰 페이로드 포함 정보:**
- 사용자 정보 (계정, 이름)
- 역할 ID (권한 구분)
- 주차장 ID (접근 권한 범위)
- 토큰 만료 시간

## 로그인 프로세스

사용자가 로그인 버튼을 클릭하면 다음 순서로 처리된다. 각 단계가 순차적으로 실행되어야 하며, 중간에 실패하면 전체 로그인 과정이 중단된다.

**처리 순서:**
1. 계정/비밀번호 입력
2. API 호출 및 토큰 발급
3. 토큰에서 사용자 정보 추출
4. 주차장 정보 설정
5. 인증 상태 활성화

## 주차장 선택 로직

토큰에 포함된 주차장 ID 값에 따라 사용자의 접근 권한이 결정된다. 최고관리자는 모든 주차장에 접근할 수 있지만, 일반관리자는 지정된 주차장에만 접근할 수 있다. 이는 권한 분리와 보안을 위한 설계이다.

**권한별 접근 범위:**
- **최고관리자** (토큰 주차장ID = 0): 수동 선택 가능
- **일반관리자** (토큰 주차장ID ≠ 0): 토큰 지정 주차장만 사용 (변경 불가)

## 자동 관리 기능

사용자 편의성을 위해 토큰 상태를 자동으로 관리한다. 앱을 다시 열었을 때도 로그인 상태가 유지되고, 토큰이 만료되면 자동으로 갱신을 시도한다. 이 과정에서 사용자의 별도 조작은 필요하지 않다.

**자동 처리 항목:**
- 앱 시작시 토큰 유효성 자동 검증
- 5분마다 토큰 상태 확인
- 토큰 만료시 자동 갱신 시도
- 갱신 실패시 자동 로그아웃

## 로그아웃

로그아웃은 단순히 클라이언트의 토큰만 삭제하는 것이 아니라, 서버에도 로그아웃을 알려 세션을 완전히 종료한다. 이후 모든 로컬 상태를 초기화하여 보안을 보장한다.

**처리 과정:**
- 서버 로그아웃 API 호출
- 모든 토큰 및 상태 초기화

관련 파일:
- main-layout.tsx
- useAuth.ts