# 유효성 검사 전역화 마이그레이션 가이드

## 개요

이 문서는 프로젝트 전체에 흩어져 있던 유효성 검사 로직을 중앙 집중식으로 관리하기 위한 마이그레이션 가이드다.

## 새로운 유효성 검사 시스템

### 1. 전역 유틸리티
- **위치**: `src/utils/validation.ts`
- **기능**: 모든 유효성 검사 로직 중앙 관리
- **지원 타입**: required, email, phone, password, ip, port, length, number, custom

### 2. React Hook
- **위치**: `src/hooks/ui-hooks/useValidation.ts`  
- **기능**: React 컴포넌트에서 쉽게 사용할 수 있는 유효성 검사 훅

## 마이그레이션 단계별 가이드

### 1단계: Import 추가

**기존:**
```typescript
import React, { useState } from 'react';
```

**변경후:**
```typescript
import React, { useState, useMemo } from 'react';
import { useValidation } from '@/hooks/ui-hooks/useValidation';
import { createRequiredRule, createLengthRule } from '@/utils/validation';
```

### 2단계: 기존 에러 상태 제거

**기존:**
```typescript
const [errors, setErrors] = useState<Record<string, string>>({});
```

**변경후:**
```typescript
// 유효성 검사 규칙 정의
const validationRules = useMemo(() => ({
  carNumber: createRequiredRule('차량번호는 필수입니다'),
  name: [
    createRequiredRule('이름은 필수입니다'),
    createLengthRule(2, 50, '2-50자 사이로 입력해주세요')
  ]
}), []);

// 새로운 유효성 검사 훅 사용
const { 
  isValid, 
  errors, 
  validateForm: validateFormData,
  clearFieldError 
} = useValidation(validationRules);
```

### 3단계: 기존 validateForm 함수 제거

**기존:**
```typescript
const validateForm = (): boolean => {
  const newErrors: Record<string, string> = {};

  if (!formData.carNumber.trim()) {
    newErrors.carNumber = '차량번호는 필수입니다.';
  }

  setErrors(newErrors);
  return Object.keys(newErrors).length === 0;
};
```

**변경후:**
```typescript
// handleSubmit에서 직접 사용
const handleSubmit = () => {
  if (mode === 'view' || !onSubmit) return;
  
  // 새로운 유효성 검사 방식 사용
  const validationResult = validateFormData(formData);
  if (!validationResult.isValid) return;
  
  // 제출 로직...
};
```

### 4단계: 에러 처리 방식 변경

**기존:**
```typescript
// 에러 메시지 제거
if (errors[field]) {
  setErrors(prev => {
    const newErrors = { ...prev };
    delete newErrors[field];
    return newErrors;
  });
}
```

**변경후:**
```typescript
// 에러 메시지 제거 (새로운 방식)
if (errors[field]) {
  clearFieldError(field);
}
```

## GridForm 연동 방법

GridForm을 사용하는 컴포넌트에서는 다음과 같이 연동할 수 있다:

```typescript
const { getFieldRulesProps, validateField } = useValidation(validationRules);

// GridForm.Rules에서 사용
<GridForm.Rules 
  {...getFieldRulesProps('carNumber', '차량번호 형식')}
>
  영문 + 숫자 조합
</GridForm.Rules>
```

### ⚠️ 중요: Validation 메시지 표시 위치

**새로운 validation 시스템에서는 모든 validation 상태와 메시지가 3열 Rules에서만 표시된다:**

- ✅ **3열 Rules**: validation 아이콘 + hover tooltip 메시지
- ❌ **4열 Content**: validation 에러 메시지 표시 금지

**잘못된 예시 (제거해야 함):**
```jsx
{field.content}
{/* ❌ 4열에 에러 메시지 표시하지 말 것 */}
{errors.fieldName && (
  <p className="text-sm text-red-500">{errors.fieldName}</p>
)}
```

**올바른 예시:**
```jsx
<GridForm.Row>
  <GridForm.Label required>필드명</GridForm.Label>
  <GridForm.Rules {...getFieldRulesProps('fieldName', '입력 규칙')}>
    2-50자 사이 입력
  </GridForm.Rules>
  <GridForm.Content>
    {/* ✅ 입력 컴포넌트만 */}
    <SimpleTextInput value={value} onChange={onChange} />
  </GridForm.Content>
</GridForm.Row>
```

## 지원되는 유효성 검사 타입

### 1. 기본 타입
- `required`: 필수 입력
- `email`: 이메일 형식  
- `phone`: 한국 휴대폰 번호
- `password`: 비밀번호 (8자 이상)
- `ip`: IP 주소 형식
- `port`: 포트 번호 (1-65535)

### 2. 고급 타입
- `length`: 문자열 길이 제한
- `number`: 숫자 범위 검사
- `custom`: 커스텀 검증 함수

### 3. 규칙 생성 헬퍼 함수
```typescript
// 필수 입력
createRequiredRule('이름은 필수입니다')

// 길이 제한
createLengthRule(2, 50, '2-50자 사이로 입력해주세요')

// 숫자 범위
createNumberRule(1, 100, '1-100 사이의 숫자를 입력해주세요')

// 커스텀 검증
createCustomRule(
  (value) => value.includes('@'),
  '@ 문자가 포함되어야 합니다'
)
```

## 마이그레이션 우선순위

### 1순위: 간단한 폼
- 단순한 validateForm 함수를 사용하는 폼
- 예시: VehicleForm.tsx ✅ (완료)

### 2순위: GridForm 사용 폼
- GridForm.Rules를 이미 사용하는 폼
- DeviceForm, ResidentForm 등

### 3순위: 복잡한 유효성 검사
- 여러 단계 검증이나 조건부 검증을 사용하는 폼

## 마이그레이션 대상 파일 목록

### 완료된 파일
- ✅ `src/components/view/_pages/basic/vehicle/VehicleForm.tsx`

### 대기 중인 파일
- ⏳ `src/components/view/_pages/device/DeviceForm.tsx`
- ⏳ `src/components/view/_pages/resident/ResidentForm.tsx`
- ⏳ `src/components/view/_pages/car/CarForm.tsx`
- ⏳ `src/components/view/_pages/instance/InstanceForm.tsx`
- ⏳ `src/components/view/_pages/operation/admin/AdminForm.tsx`
- ⏳ `src/components/view/_pages/violation/BlacklistForm.tsx`
- ⏳ `src/components/view/_etc/login/LoginForm.tsx`

## 주의사항

1. **기존 simple-input/types.ts 제거됨**: ✅ 새로운 전역 validation 시스템으로 완전히 통합됨
2. **점진적 마이그레이션**: 한 번에 모든 파일을 변경하지 말고 단계별로 진행
3. **테스트 필수**: 각 파일 마이그레이션 후 해당 기능이 정상 작동하는지 확인
4. **에러 메시지 일관성**: 동일한 검사에 대해서는 동일한 에러 메시지 사용
5. **⚠️ 메시지 표시 위치**: validation 메시지는 **오직 3열 Rules에서만** 표시. 4열 Content에 별도 에러 메시지 표시 금지

## 이점

### 1. 중앙 집중 관리
- 모든 유효성 검사 로직이 한 곳에서 관리됨
- 새로운 검사 규칙 추가 시 전체 프로젝트에서 즉시 사용 가능

### 2. 일관성 향상
- 동일한 검사에 대해 일관된 에러 메시지
- 표준화된 검증 로직

### 3. 코드 중복 제거
- 중복된 validateForm 함수들 제거
- 재사용 가능한 검증 규칙

### 4. 타입 안정성
- TypeScript 완전 지원
- 컴파일 타임 에러 방지

### 5. GridForm 통합
- GridForm.Rules와 seamless 연동
- 시각적 피드백 자동 제공

## 문의사항

마이그레이션 과정에서 문제가 발생하거나 질문이 있는 경우 팀 내에서 공유해주세요.
