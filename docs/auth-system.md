# 인증 시스템 가이드

## 개요

현재 프로젝트의 로그인 시스템은 프론트엔드 개발을 위한 임시 상태로 구성되어 있다. 백엔드 연결 전까지 모든 페이지에 자유롭게 접근할 수 있도록 보안 체크를 임시 비활성화한 상태이다.

## 현재 시스템 구조

### 인증 상태 관리

#### Jotai 기반 상태 관리자

- **파일 위치**: `src/store/auth.ts`
- **주요 Atom**: `isAuthenticatedAtom`, `accessTokenAtom`, `userAtom`
- **저장소**: 브라우저 로컬스토리지 (atomWithStorage 활용)

#### 더미 로그인 로직

현재 로그인 시스템은 실제 API 호출 없이 더미 데이터로 동작한다.

```ASCII ART
┌─────────────────────────────────────┐
│          Login Flow (Dummy)         │
├─────────────────────────────────────┤
│  Input: email/password              │
│      ↓                              │
│  2초 딜레이 (API 호출 시뮬레이션)    │
│      ↓                              │
│  성공: 더미 사용자 데이터 생성       │
│      ↓                              │
│  상태 업데이트 (로컬스토리지 저장)   │
└─────────────────────────────────────┘
```

### 보안 체크 비활성화 상태

#### 메인 레이아웃 보안 게이트

- **파일 위치**: `src/components/layout/main-layout.tsx`
- **비활성화 항목**:
  - 인증 상태 체크 및 자동 리다이렉트
  - 비인증 사용자 차단 화면

#### 로그인 페이지 리다이렉트

- **파일 위치**: `src/app/login/page.tsx`
- **비활성화 항목**:
  - 로그인 완료 후 자동 페이지 이동
  - 이미 로그인된 사용자 리다이렉트

## 컴포넌트별 상세 분석

### auth.ts - 인증 상태 관리자

#### 주요 Atom 구조

- `isAuthenticatedAtom`: 로그인 상태 불린값
- `userAtom`: 사용자 정보 객체
- `accessTokenAtom`: 액세스 토큰 문자열

#### 로그인 액션 (loginAtom)

현재 더미 데이터로 처리되며 실제 API 호출 구현 대기 상태이다.

#### 로그아웃 액션 (logoutAtom)

로컬스토리지 클리어 및 상태 초기화 로직이 구현되어 있다.

### main-layout.tsx - 메인 보안 게이트

#### 비활성화된 인증 체크

라우팅 레벨에서의 보안 체크가 주석처리되어 있어 모든 페이지 접근이 가능하다.

#### 활성 상태 유지 요소

- 사이드바 토글 기능
- 페이지 스크롤 관리
- 레이아웃 애니메이션

### login/page.tsx - 로그인 페이지

#### 비활성화된 자동 이동

로그인 성공 후 페이지 이동 대신 알림창으로 피드백을 제공한다.

#### 활성 상태 유지 요소2

- 폼 검증 로직
- 로딩 상태 관리
- 에러 핸들링

## 백엔드 연결 시 복구 계획

### 1단계: 주석 해제 작업

#### MainLayout 컴포넌트 복구 항목

```plaintext
// 백엔드 연결 전까지 임시 주석처리
```

위 주석이 달린 다음 항목들을 복구한다:

- import 문: `isAuthenticatedAtom`, `useRouter`
- 변수 선언: `isAuthenticated`, `router`
- useEffect: 인증 체크 및 리다이렉트
- 조건부 렌더링: 비인증 사용자 차단 화면

#### LoginPage 컴포넌트 복구 항목

동일한 주석 표시가 있는 다음 항목들을 복구한다:

- import 문: `useEffect`, `useRouter`, `isAuthenticatedAtom`
- 변수 선언: `isAuthenticated`, `router`
- useEffect: 로그인된 사용자 리다이렉트
- 조건부 렌더링: 로그인 완료 화면
- 성공 시 처리: `router.push('/')` 복구

### 2단계: API 연동 구현

#### auth.ts 수정 사항

- `loginAtom` 내부 더미 로직을 실제 API 호출로 교체
- 토큰 갱신 로직 구현
- 에러 핸들링 강화

#### 예상 API 엔드포인트

- `POST /api/auth/login`: 로그인
- `POST /api/auth/logout`: 로그아웃
- `POST /api/auth/refresh`: 토큰 갱신
- `GET /api/auth/me`: 사용자 정보 조회

### 3단계: 보안 강화

#### JWT 토큰 관리

- 액세스 토큰 자동 갱신
- 리프레시 토큰 처리
- 토큰 만료 시 자동 로그아웃

#### 권한 기반 접근 제어

- 역할별 페이지 접근 권한
- 메뉴 아이템 동적 표시/숨김
- API 호출 권한 검증

## 개발 시 주의사항

### 현재 상태에서 개발 시

- 모든 페이지가 접근 가능한 상태임을 인지
- 로그인 폼은 동작하지만 실제 인증 효과 없음
- 프로필 버튼은 더미 데이터로 표시

### 백엔드 연결 준비사항

- API 응답 형식 사전 정의 필요
- 에러 코드 표준화 필요
- 토큰 저장 방식 보안 검토 필요

### 테스트 시나리오

백엔드 연결 후 다음 시나리오 테스트가 필요하다:

- 정상 로그인/로그아웃 플로우
- 잘못된 계정 정보 처리
- 토큰 만료 시 자동 처리
- 페이지 새로고침 시 상태 유지
- 동시 로그인 세션 관리

## 관련 파일 목록

### 핵심 파일

- `src/store/auth.ts`: 인증 상태 관리
- `src/components/layout/main-layout.tsx`: 메인 보안 게이트
- `src/app/login/page.tsx`: 로그인 페이지
- `src/components/layout/login/LoginForm.tsx`: 로그인 폼 컴포넌트

### 연관 파일

- `src/components/layout/header/ProfileButton.tsx`: 프로필 드롭다운
- `src/app/login/layout.tsx`: 로그인 페이지 레이아웃
- `src/components/layout/login/INFO_LOGIN.md`: 로그인 컴포넌트 가이드

## 마이그레이션 체크리스트

### 백엔드 연결 전 준비사항

- [ ] API 명세서 확인
- [ ] 에러 코드 정의서 검토
- [ ] 토큰 저장 방식 결정
- [ ] 권한 체계 설계 완료

### 코드 복구 작업

- [ ] main-layout.tsx 주석 해제
- [ ] login/page.tsx 주석 해제
- [ ] auth.ts API 연동 구현
- [ ] 에러 처리 로직 강화

### 테스트 및 검증

- [ ] 로그인/로그아웃 기능 테스트
- [ ] 권한별 접근 제어 테스트
- [ ] 토큰 갱신 로직 테스트
- [ ] 보안 취약점 점검
